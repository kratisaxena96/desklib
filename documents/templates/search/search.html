{% extends "desklib/base.html" %}

{% load meta %}
{% load render_json_ld from json_ld %}
{% load thumbnail %}
{% load highlight %}

   
      {% block content %}
      <div class="container-fluid bg-3 text-center">
         <form method="get" action="." class="form" role="form">
            {{ form.non_field_errors }}
            <div class="form-group">
               {{ form.as_p }}
            </div>
            <div class="form-group">
               <input id="1232" type="submit" class="btn btn-primary" value="Search">
            </div>
             <h1>{{qry_st}}</h1>
            {% if sqs.fields.subjects %}
                    <dt>Subject</dt>
             {% for sub in sqs.fields.subjects|slice:":5" %}
                <ul>
                    <li><input class="facet" id="{{sub.0|cut:' '}}" type="checkbox" name="selected_facets" value="subjects_exact:{{ sub.0|urlencode }}"
                        data-toggle="toggle" /> {{ sub.0}} ({{ sub.1 }})
                    </li>
                </ul>
             {% endfor %}
                {% else %}
                    <p>No subject filters.</p>
                {% endif %}
            {% if suggestion %}
            <span>
               <p>Did You Mean: <a href="#" data-index="{{suggestion}}" id="suggest">{{suggestion}}</a></p>
            </span>
            {% endif %}
             <div>
            <!-- Begin faceting. -->
                <h2>By Subjects</h2>
            
                <div>
                    <dl>
                        {% if facets.fields.subjects %}
                            <dt>Subject</dt>
                            {# Provide only the top 5 authors #}
                            {% for sub in facets.fields.subjects|slice:":5" %}
                                <dd><a href="{{ request.get_full_path }}&amp;selected_facets=subjects_exact:{{ sub.0|urlencode }}">{{ sub.0 }}</a> ({{ sub.1 }})</dd>
                            {% endfor %}
                        {% else %}
                            <p>No subject filters.</p>
                        {% endif %}
                    </dl>
                </div>
                <!-- End faceting -->
            </div>
             <h1>{% for data in abbb %}</h1>
             <h1>{{ data }}</h1>
             {% endfor %}
             {% if query or facets %}
            <h3>Results</h3>

            <div class="container-fluid bg-4 text-left">
               <div class="row">
                  {% for result in page_obj.object_list %}
                  <div class="col-sm-4">
                     <a href="{% url 'documents:document-view' result.slug %}">
                        <div class="form-group">
                           {% thumbnail result.cover_image "80x80" crop="80% top" as im %}
                           <img src="{{ im.url }}">
                           {% empty %}
                           <h4>No image</h4>
                           {% endthumbnail %}
                           {% highlight result.summary with query html_tag "span" css_class "highlight" max_length 120 %}
                           <p>Total No of pages:{{result.no_of_pages}}  </p>
                        </div>
                     </a>
                  </div>
                   {% endfor%}
               </div>
                <h3>{{page_obj}}</h3>
               {% if page_obj.has_previous or page_obj.has_next %}
               <div>
                  {% if page_obj.has_previous %}<a href="?q={{ query }}&amp;page={{ page_obj.previous_page_number }}">{% endif %}&laquo; Previous{% if page_obj.has_previous %}</a>{% endif %}
                  |
                  {% if page_obj.has_next %}<a href="?q={{ query }}&amp;page={{ page_obj.next_page_number }}">{% endif %}Next &raquo;{% if page_obj.has_next %}</a>{% endif %}
               </div>
            </div>
               {% endif %}
               {% if is_paginated %}
                <ul class="pagination">
               {% if page_obj.has_previous %}
                    <li>
                        <a href="?q={{ query }}&amp;page={{ page_obj.previous_page_number }}">&laquo;</a>
                    </li>
               {% else %}
                    <li class="disabled">
                        <a href="#">&laquo;</a>
                    </li>
               {% endif %}
               {% for num in page_obj.paginator.page_range %}
                    {% ifequal num page_obj.number %}
                        <li class="active">
                            <a href="#">{{ num }}<span class="sr-only">(current)</span>
                            </a>
                        </li>
                    {% else %}
                         <li>
                             <a href="?q={{ query }}&amp;page={{ num }}">{{ num }}</a>
                         </li>
                    {% endifequal %}
               {% endfor %}
                {% if page_obj.has_next %}
                    <li>
                        <a href="?q={{ query }}&amp;page={{ page_obj.next_page_number }}">&raquo;
                        </a>
                    </li>
               {% else %}
                    <li class="disabled">
                        <a href="#">&raquo;</a>
                    </li>
               {% endif %}
               <ul>
               {% endif %}
            </div>
      </div>
      {% endif %}
      </form>
      </div>
      {% endblock %}
    {% block extra_js %}
      <script>
         $("#suggest").on("click", function () {
         $a = $(this).data("index");
         $('#id_q').val($a)
         $(".form").submit();
         });
         
         
         $('#id_q').autocomplete({
         source: function (request, response) {
          $.getJSON("study/autocomplete/?q=" + request.term, function (data) {
              response($.map(data, function (value, key) {
                  return {
                     label: value,
                     value: key
                  };
              }));
          });
         },
         minLength: 1
         });
      </script>
	    {% endblock extra_js %}

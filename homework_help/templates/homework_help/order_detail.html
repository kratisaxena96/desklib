{% extends "desklib/base.html" %}
{% load staticfiles %}
{% load humanize %}

{% block content %}
<section>
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb mb-0">
        <li class="breadcrumb-item"><a href="/">Home</a></li>
        <li class="breadcrumb-item"><a href="{% url 'homework_help:ask-question-view'%}">Homework</a></li>
  </ol>
</nav>
</section>
<section class="">
    <div class="container pt-4 pb-4 pt-md-5">
        <div class="row">
            <div class="col-sm-12">
                <h6><strong>Your Question</strong></h6>
                <p>{{order.question.question}}</p>
            </div>
        </div>
        <div class="">
             {% if order.question.user_questionfiles.all %}
        <div class="row">
            <div class="col-sm-12">
               <h6 class="d-inline"><strong>Your  Attachments</strong></h6>
            </div>
        </div>
            <div class="row mt-3">
                 {% for order in order.question.user_questionfiles.all %}
                <div class="col-sm-4 mb-3">
                    <div class="p-3 bg-light">
                        <span class="d-inline-block mr-2"><i class="fa fa-file"></i></span><a href="{{order.file.url}}" class="blue-font">{{order.title|truncatechars:30}}</a>
                </div>
                </div>
                 {% endfor %}
            </div>
              {% endif %}
        </div>
    </div>
</section>
<section>
    <div class="container pt-1 pb-5">
        <div class="row">
            <div class="col-sm-12">
                <h6><strong>Status Of Your Order</strong></h6>
            </div>
        </div>
        <div class="row mt-2">
            <div class="col-sm-12">
                <ul class="stepper list-unstyled bg-light-gray p-3">
                      <li class="d-inline-block step-bar first text-center">
                          <div class="step-bar-title">
                              <span class="d-inline-block" ><strong>Question Received</strong></span>
                          </div>
                          <div class="step-bar-left"></div>
                          <div class="step-bar-right"></div>
                      </li>
                       <li class="step-bar text-center d-inline-block">
                          <div class="step-bar-title">
                              <span class="d-inline-block"><strong>Payment Complete</strong></span>
                          </div>
                           <div class="step-bar-left"></div>
                           <div class="step-bar-right"></div>
                      </li>
                      <li class="step-bar text-center d-inline-block">
                          <div class="step-bar-title">
                              <span class="d-inline-block"><strong>Expert Working On Your Answer</strong></span>
                          </div>
                          <div class="step-bar-left"></div>
                          <div class="step-bar-right"></div>
                      </li>
                    <li class="step-bar text-center d-inline-block">
                          <div class="step-bar-title">
                              <span class="d-inline-block"><strong>Answer Is Posted</strong></span>
                          </div>
                          <div class="step-bar-left"></div>
                          <div class="step-bar-right"></div>
                      </li>
                </ul>
            </div>
        </div>
        <div class="status-one status-d-none">
         <div class="row mt-4">
             <div class="col-sm-12">
                 <div class="card card-body">
                    <p class="text-center mb-0"><strong>Your question is received by us</strong> </p>
                 </div>
             </div>
         </div>
        </div>
        <div class="status-two status-d-none">
        <div class="row mt-4">
             <div class="col-sm-12">
                 <div class="card card-body">
                    <p class="text-center mb-0"><strong>Your Payment process has been completed</strong> </p>
                 </div>
             </div>
         </div>
        </div>
         <div class="status-three status-d-none">
         <div class="row mt-4">
             <div class="col-sm-12">
                 <div class="card card-body">
                    <p class="text-center mb-0"><strong>Our expert team working on your questions related answers</strong> </p>
                 </div>
             </div>
         </div>
         </div>
        <div class="status-four status-d-none">
        <div class="row mt-4">
             <div class="col-sm-12">
                 <div class="card card-body">
                    <p class="text-center mb-0"><strong>your answer is posted</strong> </p>
                 </div>
             </div>
         </div>
        </div>
    </div>
</section>

{% comment %}
<div class="comments"></div>

<form action="" method="post" id="comment-form" enctype="multipart/form-data">
    {% csrf_token %}
    {{form.as_p}}

    <span class="reference_files"></span>
    <br>
    <input type="submit" value="Submit">
</form>
{% endcomment %}
{% endblock %}


{% block extra_js %}

<script>
 $(document).ready(function(){
    var status = $("{{order.get_status_display}}");
        if(status == "Question Recieved")
           $("ul.stepper li.step-bar.first").addClass('active');
           $('.status-one').css('display','block');
              console.log('success');

   });
</script>

<script>
jQuery(document).ready(function() {

setInterval(get_status, 10000);

function get_status(){
    var feedback = $.ajax({
          type: 'GET',
          url: "{% url 'api:homework-help-api:order-status-api' order.uuid %}",
    success:function(data){

        console.log(data)

    }
})
}







    $.ajax({
          type: 'GET',
          url: "{% url 'api:homework-help-api:comment-create-api' order.order_id %}",
          success: function(data){
            var catObj;
            catObj={};
    $(".comments").empty();


            console.log(data);
//            console.log(data.size());
//                $.each( data, function( key, value ) {
                $.each( data, function( index, value ) {


                if(value['message'] && value['reference_files']){
                $(".comments").append('<div class="current' + index + '"></div>');
                $('.current' + index).text( value['message'] + ' ' + value['reference_files'] )
                  }
                else if(value['message']){
                $(".comments").append('<div class="current' + index + '"></div>');
                $('.current' + index ).text( value['message'] )
                  }
                  else if(value['reference_files']){
                $(".comments").append('<div class="current' + index + '"></div>');
                $('.current' + index ).text( value['reference_files'] )
                  }


            });

          },
          error: function(data) {
              $(".faqQuesTab").hide();
              $("#faqPreloader").hide();
              $(".errorDiv").show();
          }
        });


    $("#comment-form").submit(function(e) {
        e.preventDefault();
        $("span.has-error").empty();

        var data = $("#comment-form").serializeArray();


                if(data['message'] && data['reference_files']){
                $(".comments").append('<div class="current"></div>');
                $(".current").text( data['message'] + ' ' + data['reference_files'] )
                  }
                else if(data['message']){
                $(".comments").append('<div class="current"></div>');
                $(".current").text( data['message'] )
                  }
                  else if(data['reference_files']){
                $(".comments").append('<div class="current"></div>');
                $(".current").text( data['reference_files'] )
                  }





        var myForm = document.getElementById('comment-form');
        data = new FormData(myForm);


        $("div.error_file").text("");

                $(".enquiry-form-popup").hide();
                $(".form-icon-plane").hide();
                $(".form-loader").show();

        $.ajax({
            type : "POST",
            url : '{% url 'api:homework-help-api:comment-create-api' order.order_id %}',
            enctype: 'multipart/form-data',
            data: data,
            processData: false,
            contentType: false,
            success: function(data){


                if(data['message'] && data['reference_files']){
                $(".comments").append('<div class="current"></div>');
                $(".current").text( data['message'] + ' ' + data['reference_files'] )
                  }
                else if(data['message']){
//                $(".comments").append("<code>" + data['message'] + "</code><br>");

                $(".comments").append('<div class="current"></div>');
                $(".current").text( data['message'] )
                  }
                  else if(data['reference_files']){
//                    $(".comments").append( data['reference_files'] + "<br>");
                $(".comments").append('<div class="current"></div>');
                $(".current").text( data['reference_files'] )
                  }


                document.getElementById("comment-form").reset();
            },
            error: function(data){

            var response = data.responseJSON;
            for (key in response) {
              $("#comment-form ."+key).addClass("has-error");
              $("#comment-form span." + key).text(response[key][0]);
            }

            }
        });
    });

});
</script>

{% endblock extra_js %}
